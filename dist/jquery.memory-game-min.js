!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";e.memoryGame=function(t,i){var s=this;s.$el=e(t),s.$el.data("memoryGame",s),s.options=e.extend({tileClass:"memory-tile",flipTimeout:2e3,maxTiles:1e3,showScore:!0,showRestart:!0,createDuplicates:!0},i),s.Game={_state:"not_ready",_originalTiles:[],_originalTilesMatches:[],_tiles:[],_numTiles:0,_tile1idx:void 0,_tile2idx:void 0,_matches:0,_guesses:0,setTiles:function(e,t){this._originalTiles=e,this._originalTilesMatches=t,this.loadTiles(),this.shuffleTiles()},shuffleTiles:function(){this._shuffle(this._tiles)},shuffleOriginalTiles:function(){this._shuffle(this._originalTiles,this._originalTilesMatches)},_shuffle:function(e,t){for(var i=e.length-1;i>0;i--){var s=Math.floor(Math.random()*(i+1)),l=e[i];if(e[i]=e[s],e[s]=l,t&&t.length>0){l=t[i];t[i]=t[s],t[s]=l}}},openTile:function(e){if("locked"!==this._state&&!this._tiles[e]._opened){if(this._tiles[e].turnOver(),s.$el.find(".game-tile-"+e).removeClass("game-tile-closed").addClass("game-tile-open").html(this._tiles[e]._html),"one_open"===this._state){this._tile2idx=e;var t=this;this._state="locked",this.isMatch()?setTimeout(function(){t.setMatched()},500):setTimeout(function(){t.turnOverTiles()},s.options.flipTimeout),this._guesses++,s.$el.find(".game-score span").text(this._guesses)}else this._tile1idx=e,this._state="one_open";"function"==typeof s.options.tileClickedCallback&&s.options.tileClickedCallback({state:this._state,index:e,tile:this._tiles[e],guesses:this._guesses})}},isMatch:function(){return this._tiles[this._tile1idx]._value===this._tiles[this._tile2idx]._value},turnOverTiles:function(){this._tiles[this._tile1idx]._opened=0,s.$el.find(".game-tile-"+this._tile1idx).removeClass("game-tile-open").addClass("game-tile-closed").addClass("game-tile-viewed").html(""),this._tiles[this._tile2idx]._opened=0,s.$el.find(".game-tile-"+this._tile2idx).removeClass("game-tile-open").addClass("game-tile-closed").addClass("game-tile-viewed").html(""),this._state="ready","function"==typeof s.options.mismatchedCallback&&s.options.mismatchedCallback({tile1:this._tiles[this._tile1idx],tile2:this._tiles[this._tile2idx],guesses:this._guesses}),this._tile1idx=void 0,this._tile2idx=void 0},setMatched:function(){this._tiles[this._tile1idx]._matched=1,s.$el.find(".game-tile-"+this._tile1idx).addClass("game-tile-matched"),this._tiles[this._tile2idx]._matched=1,s.$el.find(".game-tile-"+this._tile2idx).addClass("game-tile-matched"),this._matches++,"function"==typeof s.options.matchedCallback&&s.options.matchedCallback({tile1:this._tiles[this._tile1idx],tile2:this._tiles[this._tile2idx],matches:this._matches,guesses:this._guesses}),this._tile1idx=void 0,this._tile2idx=void 0,this.isGameOver()?(this._state="complete",s.$el.addClass("game-complete"),"function"==typeof s.options.gameOverCallback&&s.options.gameOverCallback({matches:this._matches,guesses:this._guesses})):this._state="ready"},isGameOver:function(){return this._matches>=this._numTiles/2},loadTiles:function(){this.shuffleOriginalTiles();var t=Math.round(s.options.maxTiles/2),i=t<this._originalTiles.length?t:this._originalTiles.length;this._tiles=[];for(var l=0;l<i;l++)this._tiles.push(e.extend(!0,{},this._originalTiles[l])),s.options.createDuplicates?this._tiles.push(e.extend(!0,{},this._originalTiles[l])):this._tiles.push(e.extend(!0,{},this._originalTilesMatches[l]));this._numTiles=this._tiles.length},restart:function(){s.$el.removeClass("game-complete"),this._state="ready",this._guesses=0,this._matches=0,this._tile1idx=void 0,this._tile2idx=void 0,this.loadTiles(),this.shuffleTiles(),this.updateDisplay(),"function"==typeof s.options.restartCallback&&s.options.restartCallback()},updateDisplay:function(){for(var e="",t=0;t<this._numTiles;t++)this._tiles[t].setIndex(t),e+=this._tiles[t].getHtml();s.$el.find(".game-tiles").html(e),s.$el.find(".game-score span").text(this._guesses)},display:function(){s.$el.addClass("memory-game").find("."+s.options.tileClass).first().removeClass(s.options.tileClass).addClass("game-tiles").empty(),s.$el.find("."+s.options.tileClass).remove();var e="";(s.options.showScore||s.options.showRestart)&&(e+='<div class="game-status">',s.options.showScore&&(e+='<div class="game-score">Score: <span>0</span></div>'),s.options.showRestart&&(e+='<div class="game-restart">Restart</div>'),e+="</div>"),s.$el.append(e),this.updateDisplay()}},s.Tile={_index:void 0,_value:void 0,_data:{},_html:"",_opened:!1,_matched:!1,_viewed:!1,getValue:function(){return this._value},setValue:function(e){this._value=e},setIndex:function(e){this._index=e},setData:function(e){this._data=e},setHtml:function(e){this._html=e},getHtml:function(){return'<div class="game-tile-'+this._index+' game-tile game-tile-closed"></div>'},turnOver:function(){this._opened=!this._opened,this._viewed=!0},matched:function(){this._matched=!0},isOpened:function(){return this._opened},isMatched:function(){return this._matched},isViewed:function(){return this._viewed},reset:function(){this._opened=!1,this._matched=!1,this._viewed=!1}},s.methods={init:function(){s.methods.setup(),s.$el.off(),s.$el.on("click",".game-tile",function(e){e.preventDefault();var t=s.$el.find(".game-tiles").children().index(this);s.methods.tileClicked(t)}),s.$el.on("click",".game-restart",function(e){e.preventDefault(),s.Game.restart()})},setup:function(){s.methods._loadTiles(),s.Game.display()},tileClicked:function(e){s.Game.openTile(e)},_loadTiles:function(){for(var e=[],t=[],i=s.options.createDuplicates?1:2,l=s.$el.find("."+s.options.tileClass),a=0;a<l.length;a+=i){if(!s.options.createDuplicates&&a+1>=l.length){console.warn("Incorrect number of tiles for game, must be an even number.");break}var n=l.eq(a),o=s.methods._createTile(n,a);if(e.push(o),!s.options.createDuplicates){n=l.eq(a+1),o=s.methods._createTile(n,a);t.push(o)}}s.Game.setTiles(e,t)},_createTile:function(e,t){var i=Object.create(s.Tile);return i.setValue(t),i.setData(e.data()),i.setHtml(e[0].outerHTML),i},_debugTiles:function(){for(var e=0;e<s.Game._tiles.length;e++)console.log(s.Game._tiles[e]._value)}},s.methods.init(),e.fn.memoryGame.restart=function(){s.Game.restart()}},e.fn.memoryGame=function(t){return this.each(function(){return new e.memoryGame(this,t)})}});